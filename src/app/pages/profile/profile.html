<div class="p-6">
  <div class="flex justify-between items-center border-b border-gray-200 pb-4 mb-6">
    <h1 class="text-3xl font-bold" style="color: #0d5a4b">My Profile</h1>
    @if (user?.id && !isEditMode) {
    <button
      (click)="toggleEditMode()"
      class="px-4 py-2 text-white rounded-md transition-colors flex items-center gap-2"
      style="background-color: #e2b43a; color: #0a3022"
      onmouseover="this.style.backgroundColor='#d4a530'"
      onmouseout="this.style.backgroundColor='#E2B43A'"
    >
      <lucide-angular [img]="Edit2" class="w-5 h-5" />
      Edit Profile
    </button>
    }
  </div>

  @if (user) { @if (!isEditMode) {
  <!-- View Mode -->
  <!-- Profile Image and Basic Info -->
  <div class="bg-white rounded-lg border border-gray-200 p-6 mb-6">
    <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
      <div class="flex-shrink-0">
        <img
          [src]="getFullImageUrl(user.imageUrl)"
          [alt]="getFullName()"
          class="w-32 h-32 rounded-full object-cover border-4"
          style="border-color: #e2b43a"
          onerror="this.src='profile/person.jpg'"
        />
      </div>
      <div class="flex-1 text-center md:text-left">
        <h2 class="text-2xl font-bold mb-2" style="color: #0d5a4b">
          {{ getFullName() }}
        </h2>
        <p class="text-gray-600 mb-4">{{ user.userName || '-' }}</p>
        <div class="flex flex-wrap gap-2 justify-center md:justify-start">
          @if (user.roles && user.roles.length > 0) { @for (role of user.roles; track role) {
          <span
            class="px-3 py-1 rounded-full text-sm font-semibold"
            style="background-color: #e2b43a; color: #0a3022"
          >
            {{ role }}
          </span>
          } }
        </div>
      </div>
    </div>
  </div>

  <!-- User Information Card -->
  <div class="bg-white rounded-lg border border-gray-200 p-6 mb-6">
    <h2 class="text-2xl font-semibold mb-4" style="color: #0d5a4b">Personal Information</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="text-sm font-medium text-gray-500">User Name</label>
        <p class="text-lg text-gray-900 mt-1">{{ user.userName || '-' }}</p>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-500">Full Name</label>
        <p class="text-lg text-gray-900 mt-1">{{ getFullName() }}</p>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-500">Email</label>
        <p class="text-lg text-gray-900 mt-1">{{ user.email || '-' }}</p>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-500">Phone Number</label>
        <p class="text-lg text-gray-900 mt-1">{{ getDisplayPhone() }}</p>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-500">Status</label>
        <div class="mt-1">
          <span
            class="inline-block px-3 py-1 rounded-full text-sm font-semibold"
            [style.background-color]="user.isActive ? '#d1fae5' : '#fee2e2'"
            [style.color]="user.isActive ? '#065f46' : '#991b1b'"
          >
            {{ user.isActive ? 'Active' : 'Inactive' }}
          </span>
        </div>
      </div>
      <div>
        <label class="text-sm font-medium text-gray-500">Email Confirmed</label>
        <div class="mt-1">
          <span
            class="inline-block px-3 py-1 rounded-full text-sm font-semibold"
            [style.background-color]="user.emailConfirmed ? '#d1fae5' : '#fee2e2'"
            [style.color]="user.emailConfirmed ? '#065f46' : '#991b1b'"
          >
            {{ user.emailConfirmed ? 'Confirmed' : 'Not Confirmed' }}
          </span>
        </div>
      </div>
    </div>
  </div>
  } @else {
  <!-- Edit Mode -->
  <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="space-y-6">
    <!-- Profile Image Upload -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
      <h2 class="text-2xl font-semibold mb-4" style="color: #0d5a4b">Profile Image</h2>
      <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
        <div class="flex-shrink-0 relative">
          <img
            [src]="imagePreview || getFullImageUrl(user.imageUrl)"
            [alt]="getFullName()"
            class="w-32 h-32 rounded-full object-cover border-4"
            style="border-color: #e2b43a"
            onerror="this.src='profile/person.jpg'"
          />
          @if (imagePreview || selectedImage) {
          <button
            type="button"
            (click)="removeImage()"
            class="absolute top-0 right-0 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors"
            title="Remove image"
          >
            <lucide-angular [img]="X" class="w-4 h-4" />
          </button>
          }
        </div>
        <div class="flex-1">
          <label class="block text-sm font-medium text-gray-700 mb-2">Upload New Image</label>
          <input
            type="file"
            accept="image/*"
            (change)="onImageSelected($event)"
            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-transparent"
            style="--tw-ring-color: #e2b43a"
            onfocus="this.style.borderColor='#E2B43A'; this.style.boxShadow='0 0 0 2px rgba(226, 180, 58, 0.2)'"
            onblur="this.style.borderColor=''; this.style.boxShadow=''"
          />
          <p class="mt-2 text-sm text-gray-500">
            Max file size: 5MB. Supported formats: JPG, PNG, GIF
          </p>
        </div>
      </div>
    </div>

    <!-- Personal Information -->
    <div class="bg-white rounded-lg border border-gray-200 p-6">
      <h2 class="text-2xl font-semibold mb-4" style="color: #0d5a4b">Personal Information</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- First Name -->
        <div>
          <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">
            First Name <span class="text-red-500">*</span>
          </label>
          <input
            id="firstName"
            type="text"
            formControlName="firstName"
            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-transparent"
            style="--tw-ring-color: #e2b43a"
            onfocus="this.style.borderColor='#E2B43A'; this.style.boxShadow='0 0 0 2px rgba(226, 180, 58, 0.2)'"
            onblur="this.style.borderColor=''; this.style.boxShadow=''"
            [class.border-red-500]="f['firstName'].invalid && f['firstName'].touched"
            placeholder="Enter first name"
          />
          @if (f['firstName'].invalid && f['firstName'].touched) {
          <p class="mt-1 text-sm text-red-500">First name is required</p>
          }
        </div>

        <!-- Last Name -->
        <div>
          <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">
            Last Name <span class="text-red-500">*</span>
          </label>
          <input
            id="lastName"
            type="text"
            formControlName="lastName"
            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-transparent"
            style="--tw-ring-color: #e2b43a"
            onfocus="this.style.borderColor='#E2B43A'; this.style.boxShadow='0 0 0 2px rgba(226, 180, 58, 0.2)'"
            onblur="this.style.borderColor=''; this.style.boxShadow=''"
            [class.border-red-500]="f['lastName'].invalid && f['lastName'].touched"
            placeholder="Enter last name"
          />
          @if (f['lastName'].invalid && f['lastName'].touched) {
          <p class="mt-1 text-sm text-red-500">Last name is required</p>
          }
        </div>

        <!-- Email -->
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
            Email <span class="text-red-500">*</span>
          </label>
          <input
            id="email"
            type="email"
            formControlName="email"
            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-transparent"
            style="--tw-ring-color: #e2b43a"
            onfocus="this.style.borderColor='#E2B43A'; this.style.boxShadow='0 0 0 2px rgba(226, 180, 58, 0.2)'"
            onblur="this.style.borderColor=''; this.style.boxShadow=''"
            [class.border-red-500]="f['email'].invalid && f['email'].touched"
            placeholder="Enter email"
          />
          @if (f['email'].invalid && f['email'].touched) {
          <p class="mt-1 text-sm text-red-500">
            @if (f['email'].errors?.['required']) { Email is required } @if
            (f['email'].errors?.['email']) { Please enter a valid email }
          </p>
          }
        </div>

        <!-- Country Code -->
        <div class="relative country-dropdown-container">
          <label for="countryCode" class="block text-sm font-medium text-gray-700 mb-2">
            Country Code <span class="text-red-500">*</span>
          </label>
          <input type="hidden" formControlName="countryCode" id="countryCode" />
          <div class="relative">
            <button
              type="button"
              (click)="toggleCountryDropdown()"
              class="w-full px-4 py-2 border rounded-md focus:outline-none focus:border-transparent bg-white text-left flex items-center justify-between"
              [class.border-red-500]="f['countryCode'].invalid && f['countryCode'].touched"
              [class.border-gray-300]="!(f['countryCode'].invalid && f['countryCode'].touched)"
              style="--tw-ring-color: #e2b43a"
              onfocus="this.style.borderColor='#E2B43A'; this.style.boxShadow='0 0 0 2px rgba(226, 180, 58, 0.2)'"
              onblur="this.style.borderColor=''; this.style.boxShadow=''"
            >
              <div class="flex items-center gap-2">
                @if (selectedCountry) {
                <img
                  [src]="selectedCountry.flagUrl"
                  [alt]="selectedCountry.nameAr"
                  class="w-6 h-4 object-cover rounded"
                  onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2224%22%3E%3Crect fill=%22%23ccc%22 width=%2240%22 height=%2224%22/%3E%3C/svg%3E'"
                />
                <span class="text-gray-700">{{ selectedCountry.code }}</span>
                } @else {
                <span class="text-gray-400">Select Country</span>
                }
              </div>
              <svg
                class="w-5 h-5 text-gray-400 transition-transform"
                [class.rotate-180]="countryDropdownOpen"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </button>

            @if (countryDropdownOpen) {
            <div
              class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto"
            >
              @for (country of countries; track country.code) {
              <button
                type="button"
                (click)="selectCountry(country)"
                class="w-full px-4 py-3 flex items-center gap-3 hover:bg-gray-50 transition-colors text-left"
                [class.bg-gray-50]="selectedCountry?.code === country.code"
                [class.border-l-4]="selectedCountry?.code === country.code"
                [style.border-left-color]="
                  selectedCountry?.code === country.code ? '#E2B43A' : 'transparent'
                "
              >
                <img
                  [src]="country.flagUrl"
                  [alt]="country.nameAr"
                  class="w-8 h-6 object-cover rounded"
                  onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2224%22%3E%3Crect fill=%22%23ccc%22 width=%2240%22 height=%2224%22/%3E%3C/svg%3E'"
                />
                <div class="flex-1">
                  <div class="text-sm font-medium text-gray-900" style="color: #0d5a4b">
                    {{ country.nameAr }}
                  </div>
                  <div class="text-sm text-gray-500">{{ country.code }}</div>
                </div>
              </button>
              }
            </div>
            }
          </div>
          @if (f['countryCode'].invalid && f['countryCode'].touched) {
          <p class="mt-1 text-sm text-red-500">Country code is required</p>
          }
        </div>

        <!-- Phone Number -->
        <div>
          <label for="phoneNumber" class="block text-sm font-medium text-gray-700 mb-2">
            Phone Number <span class="text-red-500">*</span>
          </label>
          <input
            id="phoneNumber"
            type="tel"
            formControlName="phoneNumber"
            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-transparent"
            style="--tw-ring-color: #e2b43a"
            onfocus="this.style.borderColor='#E2B43A'; this.style.boxShadow='0 0 0 2px rgba(226, 180, 58, 0.2)'"
            onblur="this.style.borderColor=''; this.style.boxShadow=''"
            [class.border-red-500]="f['phoneNumber'].invalid && f['phoneNumber'].touched"
            placeholder="Enter phone number"
          />
          @if (f['phoneNumber'].invalid && f['phoneNumber'].touched) {
          <p class="mt-1 text-sm text-red-500">Phone number is required</p>
          }
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="flex justify-end gap-4">
      <button
        type="button"
        (click)="toggleEditMode()"
        class="px-6 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors flex items-center gap-2"
      >
        <lucide-angular [img]="X" class="w-5 h-5" />
        Cancel
      </button>
      <button
        type="submit"
        [disabled]="saving || profileForm.invalid"
        class="px-6 py-2 text-white rounded-md transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
        style="background-color: #0d5a4b; color: white"
        onmouseover="this.style.backgroundColor='#0f6b5a'"
        onmouseout="this.style.backgroundColor='#0D5A4B'"
      >
        @if (saving) {
        <span>Saving...</span>
        } @else {
        <lucide-angular [img]="Check" class="w-5 h-5" />
        <span>Save Changes</span>
        }
      </button>
    </div>
  </form>
  }

  <!-- Additional Information Card (Read Only) -->
  @if ((user.id || user.userId) && !isEditMode) {
  <div class="bg-white rounded-lg border border-gray-200 p-6">
    <h2 class="text-2xl font-semibold mb-4" style="color: #0d5a4b">Account Information</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="text-sm font-medium text-gray-500">User ID</label>
        <p class="text-lg text-gray-900 mt-1 font-mono text-sm">
          {{ user.id || user.userId || '-' }}
        </p>
      </div>
      @if (user.tenantId || user.tenant) {
      <div>
        <label class="text-sm font-medium text-gray-500">Tenant</label>
        <p class="text-lg text-gray-900 mt-1">{{ user.tenantId || user.tenant || '-' }}</p>
      </div>
      }
    </div>
  </div>
  } } @else {
  <div class="bg-white rounded-lg border border-gray-200 p-12 text-center">
    <lucide-angular [img]="User" class="w-16 h-16 mx-auto mb-4 text-gray-400" />
    <p class="text-gray-500 text-lg">No user data available</p>
    <p class="text-gray-400 text-sm mt-2">Please log in to view your profile</p>
  </div>
  }
</div>
